# 问题分析

## 错误 1: `/api/v1/groups/` 404 Not Found
- **原因**: `groups.py` 中的 `list_groups` 函数存在逻辑问题
- **具体问题**: 当用户是教师但没有提供 `teacher_id` 时，会使用 `cu.get("sub", None)` 作为 `teacher_internal_id`，但如果 `cu.get("sub")` 返回 `None`，就会导致后续的 SQL 查询失败，最终返回 404 错误

## 错误 2: `/api/v1/users/teachers` 500 Internal Server Error
- **原因**: 虽然路由已正确定义，但可能存在数据库连接或表结构问题
- **具体问题**: `create_teacher` 函数执行时可能遇到数据库错误，如 `teachers` 表不存在或结构不正确

# 修复方案

## 1. 修复 groups.py 中的 404 错误
- **修改文件**: `app/api/v1/endpoints/groups.py`
- **修改点**: `list_groups` 函数
- **具体修改**: 当 `teacher_internal_id` 为 `None` 时，返回明确的 400 错误信息，而不是让 SQL 查询失败

## 2. 修复 users.py 中的 500 错误
- **检查数据库连接**: 确保数据库连接正常
- **检查表结构**: 确保 `teachers` 表存在且结构正确
- **修改文件**: `app/api/v1/endpoints/users.py`
- **修改点**: `create_teacher` 函数
- **具体修改**: 增强错误处理，提供更详细的错误信息

# 验证步骤
1. 启动应用
2. 测试 `/api/v1/groups/` 端点，确保不再返回 404 错误
3. 测试 `/api/v1/users/teachers` 端点，确保不再返回 500 错误
4. 运行应用的测试套件，确保所有测试通过